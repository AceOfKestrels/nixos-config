# .github/workflows/lint.yml
name: "Validate Nix Files"

on:
  push:

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Nix
        uses: cachix/install-nix-action@v31
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - name: Run nixfmt --check
        run: |
          files=$(git ls-files '*.nix')

          if [ -z "$files" ]; then
            echo "No .nix files to check."
            exit 0
          fi

          nix run nixpkgs#nixfmt-rfc-style -- --check --indent=4 $files

  build:
    name: Parse
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Nix
        uses: cachix/install-nix-action@v31
        with:
          nix_path: nixpkgs=channel:nixos-unstable

      - name: Run nix-instantiate
        run: |
          files=$(git ls-files '*.nix')

          if [ -z "$files" ]; then
            echo "No .nix files to check."
            exit 0
          fi

          nix-instantiate --parse $files > /dev/null
